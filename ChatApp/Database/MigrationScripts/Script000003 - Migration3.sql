START TRANSACTION;

ALTER TABLE "Messages" DROP CONSTRAINT "FK_Messages_Chats_ChatId";

UPDATE "Messages" SET "ChatId" = '00000000-0000-0000-0000-000000000000' WHERE "ChatId" IS NULL;
ALTER TABLE "Messages" ALTER COLUMN "ChatId" SET NOT NULL;
ALTER TABLE "Messages" ALTER COLUMN "ChatId" SET DEFAULT '00000000-0000-0000-0000-000000000000';

ALTER TABLE "Messages" ADD CONSTRAINT "FK_Messages_Chats_ChatId" FOREIGN KEY ("ChatId") REFERENCES "Chats" ("Id") ON DELETE CASCADE;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250527130414_Migration3', '8.0.13');

COMMIT;